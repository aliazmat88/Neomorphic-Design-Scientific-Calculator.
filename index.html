<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scientific Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #e8eaed;
    --surface: #e8eaed;
    --shadow-light: #ffffff;
    --shadow-dark: #c5c8d0;
    --text-primary: #5a5e6b;
    --text-secondary: #9da3b0;
    --accent: #f0c030;
    --accent-dark: #d4a820;
    --danger: #e07070;
    --rad: 28px;
  }

  body {
    background: var(--bg);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    font-family: 'DM Sans', sans-serif;
    padding: 20px;
  }

  .calculator {
    width: 380px;
    background: var(--surface);
    border-radius: 40px;
    padding: 28px 24px 32px;
    box-shadow: 20px 20px 60px var(--shadow-dark), -20px -20px 60px var(--shadow-light);
    user-select: none;
  }

  /* Top bar */
  .topbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 4px;
    margin-bottom: 8px;
  }
  .topbar-icon {
    width: 36px; height: 36px;
    border-radius: 50%;
    background: var(--surface);
    box-shadow: 4px 4px 10px var(--shadow-dark), -4px -4px 10px var(--shadow-light);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    transition: box-shadow 0.15s;
    color: var(--text-secondary);
    font-size: 14px;
  }
  .topbar-icon:hover { box-shadow: 2px 2px 6px var(--shadow-dark), -2px -2px 6px var(--shadow-light); }
  .topbar-icon:active { box-shadow: inset 2px 2px 5px var(--shadow-dark), inset -2px -2px 5px var(--shadow-light); }

  /* Mode toggle */
  .mode-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    color: var(--text-secondary);
    font-weight: 500;
    letter-spacing: 0.5px;
  }
  .mode-pill {
    background: var(--surface);
    border-radius: 20px;
    padding: 3px 4px;
    box-shadow: inset 3px 3px 7px var(--shadow-dark), inset -3px -3px 7px var(--shadow-light);
    display: flex;
    gap: 2px;
  }
  .mode-btn {
    padding: 3px 8px;
    border-radius: 16px;
    cursor: pointer;
    font-size: 10px;
    font-weight: 500;
    color: var(--text-secondary);
    transition: all 0.2s;
  }
  .mode-btn.active {
    background: var(--accent);
    color: #fff;
    box-shadow: 2px 2px 5px var(--shadow-dark);
  }

  /* Display */
  .display {
    padding: 16px 12px 20px;
    text-align: right;
    min-height: 110px;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
  }
  .expression {
    font-size: 13px;
    color: var(--text-secondary);
    font-family: 'DM Mono', monospace;
    font-weight: 300;
    min-height: 20px;
    margin-bottom: 6px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    direction: rtl;
  }
  .result {
    font-size: 48px;
    font-weight: 300;
    color: var(--text-primary);
    font-family: 'DM Mono', monospace;
    line-height: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    transition: font-size 0.15s;
  }
  .result.small { font-size: 28px; }
  .result.error { color: var(--danger); font-size: 20px; }

  /* Sci panel */
  .sci-panel {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    margin-bottom: 10px;
    overflow: hidden;
    max-height: 0;
    transition: max-height 0.35s ease, opacity 0.35s ease, margin 0.35s ease;
    opacity: 0;
  }
  .sci-panel.open {
    max-height: 300px;
    opacity: 1;
    margin-bottom: 10px;
  }

  /* Buttons */
  .btn-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }

  .btn {
    border: none;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    outline: none;
    transition: box-shadow 0.12s, transform 0.08s;
    border-radius: var(--rad);
    background: var(--surface);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
  }

  /* Round buttons */
  .btn-round {
    width: 72px; height: 72px;
    border-radius: 50%;
    font-size: 20px;
    font-weight: 400;
    color: var(--text-primary);
    box-shadow: 6px 6px 14px var(--shadow-dark), -6px -6px 14px var(--shadow-light);
  }
  .btn-round:hover { box-shadow: 8px 8px 18px var(--shadow-dark), -8px -8px 18px var(--shadow-light); }
  .btn-round:active {
    box-shadow: inset 4px 4px 10px var(--shadow-dark), inset -4px -4px 10px var(--shadow-light);
    transform: scale(0.97);
  }

  /* Op buttons (left col) */
  .btn-op {
    width: 72px; height: 72px;
    border-radius: 50%;
    font-size: 22px;
    font-weight: 300;
    color: var(--text-secondary);
    box-shadow: 5px 5px 12px var(--shadow-dark), -5px -5px 12px var(--shadow-light);
  }
  .btn-op:hover { box-shadow: 7px 7px 16px var(--shadow-dark), -7px -7px 16px var(--shadow-light); }
  .btn-op:active {
    box-shadow: inset 3px 3px 8px var(--shadow-dark), inset -3px -3px 8px var(--shadow-light);
    transform: scale(0.97);
  }

  /* Special buttons */
  .btn-ac {
    font-size: 15px;
    font-weight: 500;
    letter-spacing: 0.5px;
    color: var(--text-primary);
    box-shadow: 5px 5px 12px var(--shadow-dark), -5px -5px 12px var(--shadow-light);
  }

  .btn-equals {
    width: 72px; height: 72px;
    border-radius: 50%;
    background: var(--accent);
    font-size: 22px;
    color: #fff;
    box-shadow: 5px 5px 14px #c9a818, -3px -3px 10px #ffe070;
    transition: box-shadow 0.12s, transform 0.08s, background 0.1s;
  }
  .btn-equals:hover { background: #e8b820; box-shadow: 7px 7px 18px #c9a818, -4px -4px 12px #ffe070; }
  .btn-equals:active {
    box-shadow: inset 3px 3px 8px #c9a818, inset -2px -2px 6px #ffe070;
    transform: scale(0.97);
  }

  /* Zero button (wide) */
  .btn-zero {
    border-radius: 36px;
    height: 72px;
    font-size: 20px;
    font-weight: 400;
    color: var(--text-primary);
    box-shadow: 6px 6px 14px var(--shadow-dark), -6px -6px 14px var(--shadow-light);
    flex: 1;
  }
  .btn-zero:hover { box-shadow: 8px 8px 18px var(--shadow-dark), -8px -8px 18px var(--shadow-light); }
  .btn-zero:active {
    box-shadow: inset 4px 4px 10px var(--shadow-dark), inset -4px -4px 10px var(--shadow-light);
    transform: scale(0.98);
  }

  /* Bottom row special layout */
  .bottom-row {
    display: grid;
    grid-template-columns: 72px 1fr 72px;
    gap: 10px;
    margin-top: 0;
  }

  /* Sci small buttons */
  .btn-sci {
    height: 52px;
    border-radius: 18px;
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
    box-shadow: 4px 4px 10px var(--shadow-dark), -4px -4px 10px var(--shadow-light);
    letter-spacing: 0.2px;
  }
  .btn-sci:hover { box-shadow: 5px 5px 12px var(--shadow-dark), -5px -5px 12px var(--shadow-light); }
  .btn-sci:active {
    box-shadow: inset 3px 3px 7px var(--shadow-dark), inset -3px -3px 7px var(--shadow-light);
    transform: scale(0.97);
  }
  .btn-sci sub, .btn-sci sup { font-size: 8px; }

  /* History panel */
  .history-panel {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    margin-bottom: 0;
  }
  .history-panel.open {
    max-height: 160px;
    margin-bottom: 12px;
  }
  .history-list {
    background: var(--surface);
    border-radius: 16px;
    padding: 8px 12px;
    box-shadow: inset 3px 3px 8px var(--shadow-dark), inset -3px -3px 8px var(--shadow-light);
    max-height: 140px;
    overflow-y: auto;
    font-family: 'DM Mono', monospace;
  }
  .history-list::-webkit-scrollbar { width: 4px; }
  .history-list::-webkit-scrollbar-thumb { background: var(--shadow-dark); border-radius: 2px; }
  .history-item {
    font-size: 11px;
    color: var(--text-secondary);
    padding: 4px 0;
    border-bottom: 1px solid var(--shadow-dark);
    cursor: pointer;
    transition: color 0.15s;
  }
  .history-item:last-child { border-bottom: none; }
  .history-item:hover { color: var(--text-primary); }
  .history-item span { color: var(--text-primary); font-size: 13px; }

  /* Memory indicator */
  .mem-indicator {
    font-size: 10px;
    color: var(--accent);
    font-weight: 600;
    letter-spacing: 1px;
    text-align: right;
    padding-right: 4px;
    height: 14px;
    margin-bottom: 2px;
  }

  /* Sci toggle button */
  .sci-toggle {
    font-size: 11px;
    font-weight: 600;
    color: var(--text-secondary);
    letter-spacing: 0.5px;
  }

  @media (max-width: 420px) {
    .calculator { width: 100%; border-radius: 30px; }
    .btn-round, .btn-op, .btn-equals { width: 64px; height: 64px; }
    .btn-zero { height: 64px; }
    .btn-sci { height: 46px; font-size: 11px; }
  }
</style>
</head>
<body>
<div class="calculator">

  <!-- Top bar -->
  <div class="topbar">
    <button class="topbar-icon" id="historyToggle" title="History">⏱</button>
    <div class="mode-toggle">
      <div class="mode-pill">
        <div class="mode-btn active" id="modeDeg" onclick="setMode('deg')">DEG</div>
        <div class="mode-btn" id="modeRad" onclick="setMode('rad')">RAD</div>
      </div>
    </div>
    <button class="topbar-icon" id="sciToggleBtn" title="Scientific">ƒ</button>
  </div>

  <!-- History panel -->
  <div class="history-panel" id="historyPanel">
    <div class="history-list" id="historyList"></div>
  </div>

  <!-- Display -->
  <div class="display">
    <div class="mem-indicator" id="memIndicator"></div>
    <div class="expression" id="expression"></div>
    <div class="result" id="result">0</div>
  </div>

  <!-- Scientific panel -->
  <div class="sci-panel" id="sciPanel">
    <button class="btn btn-sci" onclick="sciFunc('sin')">sin</button>
    <button class="btn btn-sci" onclick="sciFunc('cos')">cos</button>
    <button class="btn btn-sci" onclick="sciFunc('tan')">tan</button>
    <button class="btn btn-sci" onclick="sciFunc('pi')">π</button>
    <button class="btn btn-sci" onclick="sciFunc('asin')">sin⁻¹</button>
    <button class="btn btn-sci" onclick="sciFunc('acos')">cos⁻¹</button>
    <button class="btn btn-sci" onclick="sciFunc('atan')">tan⁻¹</button>
    <button class="btn btn-sci" onclick="sciFunc('e_const')">e</button>
    <button class="btn btn-sci" onclick="sciFunc('log')">log</button>
    <button class="btn btn-sci" onclick="sciFunc('ln')">ln</button>
    <button class="btn btn-sci" onclick="sciFunc('exp')">eˣ</button>
    <button class="btn btn-sci" onclick="sciFunc('pow10')">10ˣ</button>
    <button class="btn btn-sci" onclick="sciFunc('sq')">x²</button>
    <button class="btn btn-sci" onclick="sciFunc('cube')">x³</button>
    <button class="btn btn-sci" onclick="sciFunc('pow')">xʸ</button>
    <button class="btn btn-sci" onclick="sciFunc('cbrt')">∛x</button>
    <button class="btn btn-sci" onclick="sciFunc('factorial')">n!</button>
    <button class="btn btn-sci" onclick="sciFunc('abs')">|x|</button>
    <button class="btn btn-sci" onclick="sciFunc('inv')">1/x</button>
    <button class="btn btn-sci" onclick="sciFunc('mod')">mod</button>
    <!-- Memory row -->
    <button class="btn btn-sci" onclick="memFunc('MC')">MC</button>
    <button class="btn btn-sci" onclick="memFunc('MR')">MR</button>
    <button class="btn btn-sci" onclick="memFunc('M+')">M+</button>
    <button class="btn btn-sci" onclick="memFunc('M-')">M−</button>
  </div>

  <!-- Main grid -->
  <div class="btn-grid">
    <!-- Row 1 -->
    <button class="btn btn-round btn-ac" onclick="pressAC()">AC</button>
    <button class="btn btn-round btn-ac" onclick="pressSqrt()">√</button>
    <button class="btn btn-round btn-ac" onclick="pressPercent()">%</button>
    <button class="btn btn-op" onclick="pressOp('÷')">÷</button>

    <!-- Row 2 -->
    <button class="btn btn-op" onclick="pressOp('×')">×</button>
    <button class="btn btn-round" onclick="pressNum('1')">1</button>
    <button class="btn btn-round" onclick="pressNum('2')">2</button>
    <button class="btn btn-round" onclick="pressNum('3')">3</button>

    <!-- Row 3 -->
    <button class="btn btn-op" onclick="pressOp('−')">−</button>
    <button class="btn btn-round" onclick="pressNum('4')">4</button>
    <button class="btn btn-round" onclick="pressNum('5')">5</button>
    <button class="btn btn-round" onclick="pressNum('6')">6</button>

    <!-- Row 4 -->
    <button class="btn btn-op" onclick="pressOp('+')">+</button>
    <button class="btn btn-round" onclick="pressNum('7')">7</button>
    <button class="btn btn-round" onclick="pressNum('8')">8</button>
    <button class="btn btn-round" onclick="pressNum('9')">9</button>
  </div>

  <!-- Bottom row -->
  <div class="bottom-row" style="margin-top: 10px;">
    <button class="btn btn-equals" onclick="pressEquals()">=</button>
    <button class="btn btn-zero" onclick="pressNum('0')">0</button>
    <button class="btn btn-round" onclick="pressDot()">,</button>
  </div>

</div>

<script>
// ─── State ───────────────────────────────────────────────────────────────────
let state = {
  display: '0',
  expression: '',
  operand: null,
  operator: null,
  waitingForOperand: false,
  mode: 'deg', // 'deg' | 'rad'
  memory: 0,
  history: [],
  sciOpen: false,
  historyOpen: false,
  powMode: false, // waiting for exponent
};

// ─── DOM refs ─────────────────────────────────────────────────────────────────
const $result = document.getElementById('result');
const $expr = document.getElementById('expression');
const $sciPanel = document.getElementById('sciPanel');
const $historyPanel = document.getElementById('historyPanel');
const $historyList = document.getElementById('historyList');
const $memIndicator = document.getElementById('memIndicator');

// ─── Display ─────────────────────────────────────────────────────────────────
function updateDisplay() {
  const val = state.display;
  $result.textContent = formatNum(val);
  $result.className = 'result';
  if (val === 'Error' || val.startsWith('Err')) {
    $result.className = 'result error';
  } else if (val.length > 10) {
    $result.className = 'result small';
  }
  $expr.textContent = state.expression;
  $memIndicator.textContent = state.memory !== 0 ? 'M' : '';
}

function formatNum(val) {
  if (val === 'Error' || isNaN(val) || val === '') return val;
  const n = parseFloat(val);
  if (!isFinite(n)) return val === 'Infinity' ? '∞' : val;
  // Use locale-like comma decimal for display
  if (Math.abs(n) >= 1e15 || (Math.abs(n) < 1e-9 && n !== 0)) {
    return n.toExponential(6).replace('.', ',').replace('e', '×10^');
  }
  // Format with commas as decimal separator (matching the design)
  const str = val.includes('.') ? val : (Number.isInteger(n) ? n.toString() : val);
  return str.replace('.', ',');
}

// ─── Core logic ──────────────────────────────────────────────────────────────
function calculate(a, op, b) {
  switch(op) {
    case '+': return a + b;
    case '−': return a - b;
    case '×': return a * b;
    case '÷': return b === 0 ? 'Error: ÷0' : a / b;
    case 'mod': return a % b;
    case 'pow': return Math.pow(a, b);
  }
}

function toRad(x) { return state.mode === 'deg' ? x * Math.PI / 180 : x; }
function toDeg(x) { return state.mode === 'deg' ? x * 180 / Math.PI : x; }

function factorial(n) {
  n = Math.round(n);
  if (n < 0) return NaN;
  if (n > 170) return Infinity;
  let r = 1;
  for (let i = 2; i <= n; i++) r *= i;
  return r;
}

function clean(n) {
  // Fix floating point precision
  return parseFloat(n.toPrecision(12));
}

// ─── Button handlers ─────────────────────────────────────────────────────────
function pressNum(d) {
  ripple(event);
  if (state.waitingForOperand) {
    state.display = d;
    state.waitingForOperand = false;
  } else {
    state.display = state.display === '0' ? d : state.display + d;
  }
  updateDisplay();
}

function pressDot() {
  ripple(event);
  if (state.waitingForOperand) { state.display = '0.'; state.waitingForOperand = false; updateDisplay(); return; }
  if (!state.display.includes('.')) { state.display += '.'; }
  updateDisplay();
}

function pressOp(op) {
  ripple(event);
  const current = parseFloat(state.display);
  if (state.operator && !state.waitingForOperand) {
    const result = calculate(state.operand, state.operator, current);
    if (typeof result === 'string') { state.display = result; state.operator = null; state.operand = null; updateDisplay(); return; }
    const r = clean(result);
    state.display = r.toString();
    state.operand = r;
  } else {
    state.operand = current;
  }
  state.operator = op;
  state.expression = `${formatNum(state.operand.toString())} ${op}`;
  state.waitingForOperand = true;
  updateDisplay();
}

function pressEquals() {
  ripple(event);
  if (state.operator === null) return;
  const current = parseFloat(state.display);
  const expr = `${formatNum(state.operand.toString())} ${state.operator} ${formatNum(state.display)}`;
  const result = calculate(state.operand, state.operator, current);
  if (typeof result === 'string') { state.display = result; state.expression = ''; state.operator = null; updateDisplay(); return; }
  const r = clean(result);
  addHistory(expr, r);
  state.display = r.toString();
  state.expression = `${expr} =`;
  state.operator = null;
  state.operand = null;
  state.waitingForOperand = true;
  updateDisplay();
}

function pressAC() {
  ripple(event);
  state.display = '0';
  state.expression = '';
  state.operator = null;
  state.operand = null;
  state.waitingForOperand = false;
  updateDisplay();
}

function pressSqrt() {
  ripple(event);
  const n = parseFloat(state.display);
  if (n < 0) { state.display = 'Error'; updateDisplay(); return; }
  const r = clean(Math.sqrt(n));
  addHistory(`√(${formatNum(state.display)})`, r);
  state.display = r.toString();
  state.expression = `√(${formatNum(state.display)})`;
  state.waitingForOperand = true;
  updateDisplay();
}

function pressPercent() {
  ripple(event);
  const n = parseFloat(state.display);
  if (state.operand !== null) {
    state.display = clean(state.operand * n / 100).toString();
  } else {
    state.display = clean(n / 100).toString();
  }
  state.waitingForOperand = true;
  updateDisplay();
}

function sciFunc(fn) {
  ripple(event);
  const n = parseFloat(state.display);
  let r;
  let label = '';
  switch(fn) {
    case 'sin': r = clean(Math.sin(toRad(n))); label = `sin(${n})`; break;
    case 'cos': r = clean(Math.cos(toRad(n))); label = `cos(${n})`; break;
    case 'tan':
      if (state.mode === 'deg' && (n % 180 === 90)) { r = 'Error'; break; }
      r = clean(Math.tan(toRad(n))); label = `tan(${n})`; break;
    case 'asin':
      if (n < -1 || n > 1) { r = 'Error'; break; }
      r = clean(toDeg(Math.asin(n))); label = `asin(${n})`; break;
    case 'acos':
      if (n < -1 || n > 1) { r = 'Error'; break; }
      r = clean(toDeg(Math.acos(n))); label = `acos(${n})`; break;
    case 'atan': r = clean(toDeg(Math.atan(n))); label = `atan(${n})`; break;
    case 'log': r = n <= 0 ? 'Error' : clean(Math.log10(n)); label = `log(${n})`; break;
    case 'ln': r = n <= 0 ? 'Error' : clean(Math.log(n)); label = `ln(${n})`; break;
    case 'exp': r = clean(Math.exp(n)); label = `e^(${n})`; break;
    case 'pow10': r = clean(Math.pow(10, n)); label = `10^(${n})`; break;
    case 'sq': r = clean(n * n); label = `(${n})²`; break;
    case 'cube': r = clean(n * n * n); label = `(${n})³`; break;
    case 'cbrt': r = clean(Math.cbrt(n)); label = `∛(${n})`; break;
    case 'pow':
      state.operator = 'pow';
      state.operand = n;
      state.expression = `${formatNum(state.display)}^`;
      state.waitingForOperand = true;
      updateDisplay(); return;
    case 'inv': r = n === 0 ? 'Error' : clean(1 / n); label = `1/(${n})`; break;
    case 'factorial': r = factorial(n); r = isFinite(r) ? r : '∞'; label = `${n}!`; break;
    case 'abs': r = Math.abs(n); label = `|${n}|`; break;
    case 'mod':
      state.operator = 'mod';
      state.operand = n;
      state.expression = `${formatNum(state.display)} mod`;
      state.waitingForOperand = true;
      updateDisplay(); return;
    case 'pi': r = Math.PI; label = 'π'; state.waitingForOperand = false; break;
    case 'e_const': r = Math.E; label = 'e'; state.waitingForOperand = false; break;
  }
  if (r === 'Error' || (typeof r === 'number' && !isFinite(r) && r !== Infinity)) {
    state.display = 'Error';
  } else {
    if (typeof r === 'number') r = r.toString();
    if (label) addHistory(label, parseFloat(r));
    state.display = r.toString();
    state.expression = label ? `${label} =` : '';
    state.waitingForOperand = true;
  }
  updateDisplay();
}

function memFunc(fn) {
  ripple(event);
  const n = parseFloat(state.display);
  switch(fn) {
    case 'MC': state.memory = 0; break;
    case 'MR': state.display = state.memory.toString(); state.waitingForOperand = true; break;
    case 'M+': state.memory = clean(state.memory + n); break;
    case 'M-': state.memory = clean(state.memory - n); break;
  }
  updateDisplay();
}

function setMode(m) {
  state.mode = m;
  document.getElementById('modeDeg').classList.toggle('active', m === 'deg');
  document.getElementById('modeRad').classList.toggle('active', m === 'rad');
}

// ─── History ─────────────────────────────────────────────────────────────────
function addHistory(expr, result) {
  state.history.unshift({ expr, result });
  if (state.history.length > 20) state.history.pop();
  renderHistory();
}

function renderHistory() {
  $historyList.innerHTML = state.history.map((h, i) =>
    `<div class="history-item" onclick="recallHistory(${i})">${h.expr} = <span>${formatNum(h.result.toString())}</span></div>`
  ).join('');
}

function recallHistory(i) {
  state.display = state.history[i].result.toString();
  state.waitingForOperand = true;
  updateDisplay();
}

// ─── Toggles ─────────────────────────────────────────────────────────────────
document.getElementById('sciToggleBtn').addEventListener('click', function(e) {
  ripple(e);
  state.sciOpen = !state.sciOpen;
  $sciPanel.classList.toggle('open', state.sciOpen);
  this.style.color = state.sciOpen ? 'var(--accent)' : '';
});

document.getElementById('historyToggle').addEventListener('click', function(e) {
  ripple(e);
  state.historyOpen = !state.historyOpen;
  $historyPanel.classList.toggle('open', state.historyOpen);
  this.style.color = state.historyOpen ? 'var(--accent)' : '';
});

// ─── Keyboard ─────────────────────────────────────────────────────────────────
document.addEventListener('keydown', (e) => {
  if ('0123456789'.includes(e.key)) { pressNum(e.key); return; }
  if (e.key === '.') { pressDot(); return; }
  if (e.key === '+') { pressOp('+'); return; }
  if (e.key === '-') { pressOp('−'); return; }
  if (e.key === '*') { pressOp('×'); return; }
  if (e.key === '/') { e.preventDefault(); pressOp('÷'); return; }
  if (e.key === 'Enter' || e.key === '=') { pressEquals(); return; }
  if (e.key === 'Escape') { pressAC(); return; }
  if (e.key === 'Backspace') {
    if (state.display.length > 1 && !state.waitingForOperand) {
      state.display = state.display.slice(0, -1);
    } else {
      state.display = '0';
    }
    updateDisplay();
  }
  if (e.key === '%') { pressPercent(); return; }
});

// ─── Ripple effect ────────────────────────────────────────────────────────────
function ripple(e) {
  if (!e || !e.currentTarget) return;
  const btn = e.currentTarget;
  btn.style.transform = 'scale(0.96)';
  setTimeout(() => { btn.style.transform = ''; }, 120);
}

// Init
updateDisplay();
</script>
</body>
</html>
